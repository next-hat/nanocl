Kind: Deployment
ApiVersion: v0.7

Namespace: global

Resources:
  - Name: deploy-example.com
    Kind: ProxyRule
    Version: v0.4
    Config:
      Watch:
        - deploy-example.global
        - deploy-example2.global
      Rules:
        - Domain: deploy-example.com
          Network: Public
          Locations:
            - Path: /
              Target:
                Url: http://deploy-example.com/v2
                Redirect: Temporary

            - Path: /v1
              Target:
                CargoKey: deploy-example.global
                CargoPort: 9000

            - Path: /v2
              Version: 1.1 # The http version to use for the request
              Headers: # Add headers to the request to enable websocket
                - Upgrade $http_upgrade # Upgrade the connection to websocket
                - Connection "Upgrade" # Upgrade the connection to websocket
              Target:
                CargoKey: deploy-example2.global
                CargoPort: 9000

# See all options:
# https://docs.next-hat.com/references/nanocl/daemon/v0.6#tag/Cargoes/operation/create_cargo
Cargoes:
  - Name: deploy-example
    Container:
      Image: nexthat/nanocl-get-started:latest
      Env:
        - APP=GET_STARTED1

  - Name: deploy-example2
    Container:
      Image: nexthat/nanocl-get-started:latest
      Env:
        - APP=GET_STARTED2
